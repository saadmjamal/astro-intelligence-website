<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Worker Emergency Cleanup</title>
    <style>
        body { 
            font-family: monospace; 
            max-width: 800px; 
            margin: 2rem auto; 
            padding: 1rem; 
            background: #1a1a1a; 
            color: #00ff00; 
        }
        .status { margin: 1rem 0; padding: 0.5rem; background: #000; border-radius: 4px; }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffff00; }
        button { 
            padding: 1rem 2rem; 
            margin: 0.5rem; 
            background: #ff4444; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 16px;
        }
        button:hover { background: #ff6666; }
        .auto-cleanup { background: #44ff44; color: black; }
        .auto-cleanup:hover { background: #66ff66; }
    </style>
</head>
<body>
    <h1>üö® SERVICE WORKER EMERGENCY CLEANUP</h1>
    
    <div class="status">
        <h3>Current Status:</h3>
        <div id="sw-count">üîç Checking service workers...</div>
        <div id="cache-count">üîç Checking caches...</div>
        <div id="storage-status">üîç Checking storage...</div>
    </div>

    <div style="text-align: center; margin: 2rem 0;">
        <button class="auto-cleanup" onclick="autoCleanup()">
            üö® EMERGENCY AUTO-CLEANUP
        </button>
        <br>
        <button onclick="manualUnregisterSW()">Unregister Service Workers</button>
        <button onclick="manualClearCaches()">Clear All Caches</button>
        <button onclick="manualClearStorage()">Clear Storage</button>
        <button onclick="forceReload()">Force Reload</button>
    </div>

    <div id="output" class="status">
        <h3>Console Output:</h3>
    </div>

    <div class="status">
        <h3>Manual Chrome DevTools Instructions:</h3>
        <ol>
            <li>Press <strong>F12</strong> or <strong>Ctrl+Shift+I</strong> (Cmd+Option+I on Mac)</li>
            <li>Go to <strong>Application</strong> tab</li>
            <li>In left sidebar, click <strong>Service Workers</strong></li>
            <li>Click <strong>"Unregister"</strong> for each service worker</li>
            <li>In left sidebar, click <strong>Storage</strong></li>
            <li>Click <strong>"Clear site data"</strong></li>
            <li>Refresh the page with <strong>Ctrl+Shift+R</strong> (Cmd+Shift+R on Mac)</li>
        </ol>
    </div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'warning';
            output.innerHTML += `<div class="${className}">${new Date().toLocaleTimeString()}: ${message}</div>`;
            console.log(message);
        }

        async function checkStatus() {
            try {
                // Check service workers
                const registrations = await navigator.serviceWorker.getRegistrations();
                document.getElementById('sw-count').innerHTML = 
                    `üîç Service Workers: ${registrations.length} found`;
                
                // Check caches
                const cacheNames = await caches.keys();
                document.getElementById('cache-count').innerHTML = 
                    `üîç Caches: ${cacheNames.length} found`;
                
                // Check storage
                const localStorageSize = Object.keys(localStorage).length;
                const sessionStorageSize = Object.keys(sessionStorage).length;
                document.getElementById('storage-status').innerHTML = 
                    `üîç Storage: ${localStorageSize} localStorage, ${sessionStorageSize} sessionStorage items`;
                
            } catch (error) {
                log(`Error checking status: ${error.message}`, 'error');
            }
        }

        async function manualUnregisterSW() {
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                log(`Found ${registrations.length} service workers`);
                
                for (const registration of registrations) {
                    await registration.unregister();
                    log(`‚úÖ Unregistered SW: ${registration.scope}`, 'success');
                }
                
                if (registrations.length === 0) {
                    log('‚úÖ No service workers to unregister', 'success');
                }
                
                await checkStatus();
            } catch (error) {
                log(`‚ùå Error unregistering service workers: ${error.message}`, 'error');
            }
        }

        async function manualClearCaches() {
            try {
                const cacheNames = await caches.keys();
                log(`Found ${cacheNames.length} caches`);
                
                for (const cacheName of cacheNames) {
                    await caches.delete(cacheName);
                    log(`‚úÖ Deleted cache: ${cacheName}`, 'success');
                }
                
                if (cacheNames.length === 0) {
                    log('‚úÖ No caches to clear', 'success');
                }
                
                await checkStatus();
            } catch (error) {
                log(`‚ùå Error clearing caches: ${error.message}`, 'error');
            }
        }

        function manualClearStorage() {
            try {
                const localCount = Object.keys(localStorage).length;
                const sessionCount = Object.keys(sessionStorage).length;
                
                localStorage.clear();
                sessionStorage.clear();
                
                log(`‚úÖ Cleared ${localCount} localStorage and ${sessionCount} sessionStorage items`, 'success');
                checkStatus();
            } catch (error) {
                log(`‚ùå Error clearing storage: ${error.message}`, 'error');
            }
        }

        function forceReload() {
            log('üîÑ Force reloading page...', 'warning');
            setTimeout(() => {
                location.reload(true);
            }, 1000);
        }

        async function autoCleanup() {
            log('üö® STARTING EMERGENCY AUTO-CLEANUP', 'warning');
            
            try {
                // Unregister service workers
                await manualUnregisterSW();
                
                // Clear caches
                await manualClearCaches();
                
                // Clear storage
                manualClearStorage();
                
                log('‚úÖ AUTO-CLEANUP COMPLETE!', 'success');
                log('üîÑ Page will reload in 3 seconds...', 'warning');
                
                setTimeout(() => {
                    location.reload(true);
                }, 3000);
                
            } catch (error) {
                log(`‚ùå Auto-cleanup failed: ${error.message}`, 'error');
                log('üîÑ Force reloading anyway...', 'warning');
                setTimeout(() => {
                    location.reload(true);
                }, 2000);
            }
        }

        // Auto-check status on load
        checkStatus();
        
        // Refresh status every 5 seconds
        setInterval(checkStatus, 5000);
    </script>
</body>
</html>